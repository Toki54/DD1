<?php

#[Route('/profile/delete-photo/{photoFilename}', name: 'app_profile_delete_photo')]
public function deletePhoto(string $photoFilename, EntityManagerInterface $entityManager): Response
{
    $user = $this->getUser();
    
    if (!$user) {
        $this->addFlash('error', 'Vous devez être connecté pour supprimer une photo.');
        return $this->redirectToRoute('app_login');
    }

    $userProfile = $user->getProfile();

    if (!$userProfile) {
        $this->addFlash('error', 'Profil non trouvé.');
        return $this->redirectToRoute('app_profile_show');
    }

    // Supprimer la photo
    $userProfile->removePhoto($photoFilename);

    // Sauvegarder les modifications
    $entityManager->flush();

    $this->addFlash('success', 'Photo supprimée avec succès.');
    return $this->redirectToRoute('app_profile_edit');
}

