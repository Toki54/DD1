{% extends 'base.html.twig' %}

{% block title %}Mes Discussions
{% endblock %}

{% block body %}
	{% block stylesheet %}
		<link rel="stylesheet" href="{{ asset('css/mess1.css') }}">
	{% endblock %}

	<div class="container">
		<div
			class="row">
			<!-- Liste des Conversations -->
			<div class="col-md-4">
				<h3>Conversations</h3>
				{% if conversations is empty %}
					<p>Aucune conversation.</p>
				{% else %}
					<div class="conversation-list">
						{% for conversation in conversations %}
							<div class="conversation-card">
								<a href="{{ path('app_messages', { 'id': conversation.user.id }) }}" class="card-link">
									<div class="card-header">
										<img src="{{ asset(conversation.user.profile.avatar ? 'uploads/avatars/' ~ conversation.user.profile.avatar : 'images/default-avatar.png') }}" alt="Avatar" class="avatar">
										<strong class="pseudo">{{ conversation.user.pseudo }}</strong>
									</div>
								</a>
								<!-- Séparation entre avatar et contenu -->
								<hr class="divider">
							</div>
						{% endfor %}
					</div>
				{% endif %}
			</div>

			<!-- Détails de la conversation -->
			<div class="col-md-8">
				{% if receiver %}
					<div class="conversation-detail-card">
						<div class="card-header">
							<h4>Conversation avec
								{{ receiver.pseudo }}</h4>
						</div>
						<div class="card-body chat-box">
							{% for message in messages %}
								<div class="message {% if message.sender == app.user %}my-message{% else %}other-message{% endif %}">
									<p>
										<strong>
											{% if message.sender == app.user %}Moi
											{% else %}
												{{ receiver.pseudo }}
											{% endif %}:
										</strong>
										{{ message.content }}
									</p>
								</div>
							{% endfor %}
						</div>

						<div class="card-footer">
							<form action="{{ path('app_message_send', { 'id': receiver.id }) }}" method="POST">
								<div class="input-group">
									<input type="text" name="content" class="form-control" placeholder="Écrire un message..." required>
									<button type="submit" class="btn btn-primary">Envoyer</button>
								</div>
							</form>
						</div>
					</div>
				{% else %}
					<p>Sélectionnez une conversation pour afficher les messages.</p>
				{% endif %}
			</div>
		</div>
	</div>
{% endblock %}

