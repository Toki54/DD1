{% extends 'base.html.twig' %}

{% block title %}Liste des Profils
{% endblock %}

{% block body %}
	{% block stylesheet %}
		<link rel="stylesheet" href="{{ asset('css/list2.css') }}">
	{% endblock %}

	<section
		class="container">
		<!-- Bloc de tri -->
		<article class="sort-container">
			<header class="sort-header">
				<h3>Filtrer les profils</h3>
			</header>
			<section class="sort-content">
				<form
					method="GET" action="{{ path('app_profiles_list') }}" class="sort-form">
					<!-- Filtre Sexe -->
					<label for="sex">Sexe:</label>
					<div>
						<input type="checkbox" name="sex" value="Homme" {% if sex == 'Homme' %} checked {% endif %}>
						Homme
						<input type="checkbox" name="sex" value="Femme" {% if sex == 'Femme' %} checked {% endif %}>
						Femme
						<input type="checkbox" name="sex" value="Autre" {% if sex == 'Autre' %} checked {% endif %}>
						Autre
					</div>

					<!-- Filtre Situation -->
					<label for="situation">Situation:</label>
					<div>
						<input type="checkbox" name="situation" value="Celibataire" {% if situation == 'Celibataire' %} checked {% endif %}>
						Célibataire
						<input type="checkbox" name="situation" value="En couple" {% if situation == 'En couple' %} checked {% endif %}>
						En couple
					</div>

					<!-- Filtre Recherche -->
					<label for="research">Je recherche:</label>
					<div>
						<input type="checkbox" name="research" value="Homme" {% if research == 'Homme' %} checked {% endif %}>
						Homme
						<input type="checkbox" name="research" value="Femme" {% if research == 'Femme' %} checked {% endif %}>
						Femme
						<input type="checkbox" name="research" value="Couple" {% if research == 'Couple' %} checked {% endif %}>
						Couple
					</div>

					<!-- Filtre Ville -->
					<label for="city">Ville:</label>
					<div>
						<input type="text" name="city" value="{{ city }}" placeholder="Ville" class="autocomplete-city">
					</div>

					<button type="submit">Appliquer le tri</button>
				</form>
			</section>
		</article>

		<!-- Liste des profils -->
		<section class="profile-container">
			{% for profile in profiles %}
				<article
					class="profile-card">
					<!-- Avatar -->
					<section class="avatar-container">
						<img src="{{ asset(profile.avatar ? 'uploads/avatars/' ~ profile.avatar : 'uploads/avatars/default-avatar.png') }}" alt="Avatar">
					</section>

					<!-- Informations -->
					<section class="info-container">
						<h2>
							<a href="{{ path('app_profile_view', { id: profile.id }) }}" class="profile-link">{{ profile.user.pseudo }}</a>
						</h2>
						<p>
							<strong>Sexe:</strong>
							{{ profile.sex|default('Non spécifié') }}</p>
						<p>
							<strong>Situation:</strong>
							{{ profile.situation|default('Non renseigné') }}</p>
						<p>
							<strong>Je recherche:</strong>
							{{ profile.research|default('Non spécifié') }}</p>
						<p>
							<strong>Biographie:</strong>
							{{ profile.biography|default('Aucune biographie') }}</p>
						<a href="{{ path('app_messages', { id: profile.user.id }) }}" class="btn btn-secondary">Envoyer un message</a>
					</section>

					<!-- Galerie de photos -->
					<section class="photo-gallery" id="gallery-{{ profile.id }}">
						{% if profile.photos %}
							{% for photo in profile.photos %}
								<img src="{{ asset('uploads/photos/' ~ photo) }}" alt="Photo" class="photo-thumbnail {% if not isSubscribed %}blurred-photo{% endif %}" data-bs-toggle="modal" data-bs-target="#photoCarousel-{{ profile.id }}" data-bs-slide-to="{{ loop.index0 }}">
							{% endfor %}
						{% else %}
							<p>Aucune photo ajoutée.</p>
						{% endif %}
					</section>
				</article>
			{% endfor %}
		</section>
	</section>

	<!-- Modals pour photos -->
	{% for profile in profiles %}
		<div class="modal fade" id="photoCarousel-{{ profile.id }}" tabindex="-1" aria-labelledby="photoCarouselLabel" aria-hidden="true">
			<div class="modal-dialog modal-fullscreen">
				<div class="modal-content" style="background-color: black;">
					<div class="modal-header">
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<div id="carouselExample{{ profile.id }}" class="carousel slide" data-bs-ride="carousel">
							<div class="carousel-inner">
								{% for photo in profile.photos %}
									<div class="carousel-item {% if loop.first %}active{% endif %}">
										<img src="{{ asset('uploads/photos/' ~ photo) }}" class="d-block w-100 {% if not isSubscribed %}blurred-photo{% endif %}" alt="User Photo" style="width: 600px; height: 600px; object-fit: cover;">
									</div>
								{% endfor %}
							</div>
							<button class="carousel-control-prev" type="button" data-bs-target="#carouselExample{{ profile.id }}" data-bs-slide="prev">
								<span class="carousel-control-prev-icon" aria-hidden="true"></span>
								<span class="visually-hidden">Précédent</span>
							</button>
							<button class="carousel-control-next" type="button" data-bs-target="#carouselExample{{ profile.id }}" data-bs-slide="next">
								<span class="carousel-control-next-icon" aria-hidden="true"></span>
								<span class="visually-hidden">Suivant</span>
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	{% endfor %}

	<!-- JS -->
	 <script src="{{ asset('script/js/profile-list.js') }}" defer></script>

	<!-- CSS flou pour les non abonnés -->
		<style>
.blurred-photo {
	filter: blur(10px);
	pointer-events: none;
}
</style>{% endblock %}

