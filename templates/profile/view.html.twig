{% extends 'base.html.twig' %}

{% block title %}Profil de {{ userProfile.user.pseudo }}{% endblock %}

{% block body %}
    {% block stylesheets %}
        <link rel="stylesheet" href="{{ asset('css/profileUser.css') }}">
    {% endblock %}

    <section class="profile-page">
        <div class="profile-container">

            <header class="profile-header">
                <h1>{{ userProfile.user.pseudo }}</h1>
                <p>Profil public</p>
            </header>

            <div class="profile-grid">

                {# ===== LEFT : PROFIL ===== #}
                <article class="card panel profile-card">
                    <h2 class="panel-title">Informations</h2>

                    <div class="profile-top">
                        <img
                            class="avatar"
                            src="{{ asset(userProfile.avatar ? 'uploads/avatars/' ~ userProfile.avatar : 'uploads/avatars/default-avatar.png') }}"
                            alt="Avatar"
                        />

                        <div class="profile-meta">
                            <div class="meta-item">
                                <span class="meta-label">Sexe</span>
                                <span class="meta-value">
                                    {{ userProfile.sex is iterable ? userProfile.sex|join(', ') : userProfile.sex|default('Non spécifié') }}
                                </span>
                            </div>

                            <div class="meta-item">
                                <span class="meta-label">Situation</span>
                                <span class="meta-value">
                                    {{ userProfile.situation is iterable ? userProfile.situation|join(', ') : userProfile.situation|default('Non renseignée') }}
                                </span>
                            </div>

                            <div class="meta-item">
                                <span class="meta-label">Recherche</span>
                                <span class="meta-value">
                                    {{ userProfile.research is iterable ? userProfile.research|join(', ') : userProfile.research|default('Non spécifié') }}
                                </span>
                            </div>

                            <div class="meta-item">
                                <span class="meta-label">Ville</span>
                                <span class="meta-value">
                                    {{ userProfile.city is iterable ? userProfile.city|join(', ') : userProfile.city|default('Non renseignée') }}
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="divider"></div>

                    <div class="bio-block">
                        <h3 class="sub-title">Biographie</h3>
                        <p class="bio-text">
                            {{ userProfile.biography is iterable ? userProfile.biography|join(', ') : userProfile.biography|default('Aucune biographie') }}
                        </p>
                    </div>

                    <div class="divider"></div>

                    <div class="actions">
                        <a href="{{ path('app_messages', { id: userProfile.user.id }) }}" class="btn btn-primary">
                            Envoyer un message
                        </a>

                        <form action="{{ path('app_profile_like', { id: userProfile.id }) }}" method="POST" class="like-form">
                            <input type="hidden" name="_token" value="{{ csrf_token('like' ~ userProfile.id) }}">
                            <button type="submit" class="btn btn-like" title="Liker ce profil">❤️ Like</button>
                        </form>
                    </div>
                </article>

                {# ===== RIGHT : GALLERY ===== #}
                <article class="card panel gallery-card">
                    <h2 class="panel-title">Galerie de photos</h2>

                    {% if isSubscribed %}
                        <div class="photo-gallery" id="gallery-{{ userProfile.id }}">
                            {% if userProfile.photos %}
                                {% for photo in userProfile.photos %}
                                    <img
                                        src="{{ asset('uploads/photos/' ~ photo) }}"
                                        alt="Photo"
                                        class="photo-thumbnail"
                                        data-bs-toggle="modal"
                                        data-bs-target="#photoCarousel-{{ userProfile.id }}"
                                        data-bs-slide-to="{{ loop.index0 }}"
                                    >
                                {% endfor %}
                            {% else %}
                                <p class="empty">Aucune photo ajoutée.</p>
                            {% endif %}
                        </div>

                        {# Modal galerie #}
                        <div class="modal fade" id="photoCarousel-{{ userProfile.id }}" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-fullscreen">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div id="carouselExample{{ userProfile.id }}" class="carousel slide" data-bs-ride="carousel">
                                            <div class="carousel-inner">
                                                {% for photo in userProfile.photos %}
                                                    <div class="carousel-item {% if loop.first %}active{% endif %}">
                                                        <img
                                                            src="{{ asset('uploads/photos/' ~ photo) }}"
                                                            class="d-block modal-photo"
                                                            alt="Photo utilisateur"
                                                        >
                                                    </div>
                                                {% endfor %}
                                            </div>
                                            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample{{ userProfile.id }}" data-bs-slide="prev">
                                                <span class="carousel-control-prev-icon"></span>
                                                <span class="visually-hidden">Précédent</span>
                                            </button>
                                            <button class="carousel-control-next" type="button" data-bs-target="#carouselExample{{ userProfile.id }}" data-bs-slide="next">
                                                <span class="carousel-control-next-icon"></span>
                                                <span class="visually-hidden">Suivant</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <p class="locked">
                            <em>
                                Pour voir la galerie de photos, vous devez être abonné.
                                <a href="{{ path('app_stripe_subscribe') }}">S'abonner</a>
                            </em>
                        </p>
                    {% endif %}
                </article>

            </div>
        </div>
    </section>

    <script src="{{ asset('script/js/profile-detail.js') }}" defer></script>
{% endblock %}
