{% extends 'base.html.twig' %}

{% block title %}Profil de
	{{ userProfile.user.pseudo }}
{% endblock %}

{% block body %}
	{% block stylesheet %}
		<link rel="stylesheet" href="{{ asset('css/profileUser.css') }}">
	{% endblock %}

	<section class="profile-detail">
		<h1>{{ userProfile.user.pseudo }}</h1>

		<img src="{{ asset(userProfile.avatar ? 'uploads/avatars/' ~ userProfile.avatar : 'uploads/avatars/default-avatar.png') }}" alt="Avatar" width="150">

		<p>
			<strong>Sexe :</strong>
			{{ userProfile.sex is iterable ? userProfile.sex|join(', ') : userProfile.sex|default('Non spécifié') }}
		</p>
		<p>
			<strong>Situation :</strong>
			{{ userProfile.situation is iterable ? userProfile.situation|join(', ') : userProfile.situation|default('Non renseignée') }}
		</p>
		<p>
			<strong>Recherche :</strong>
			{{ userProfile.research is iterable ? userProfile.research|join(', ') : userProfile.research|default('Non spécifié') }}
		</p>
		<p>
			<strong>Ville :</strong>
			{{ userProfile.city is iterable ? userProfile.city|join(', ') : userProfile.city|default('Non renseignée') }}
		</p>
		<p>
			<strong>Biographie :</strong>
			{{ userProfile.biography is iterable ? userProfile.biography|join(', ') : userProfile.biography|default('Aucune biographie') }}
		</p>

		<h3>Galerie de photos</h3>

		{% if isSubscribed %}
			<div class="photo-gallery" id="gallery-{{ userProfile.id }}">
				{% if userProfile.photos %}
					{% for photo in userProfile.photos %}
						<img src="{{ asset('uploads/photos/' ~ photo) }}" alt="Photo" class="photo-thumbnail" data-bs-toggle="modal" data-bs-target="#photoCarousel-{{ userProfile.id }}" data-bs-slide-to="{{ loop.index0 }}" style="width: 100px; height: 100px; object-fit: cover; margin: 5px;">
					{% endfor %}
				{% else %}
					<p>Aucune photo ajoutée.</p>
				{% endif %}
			</div>

			<!-- Modal galerie -->
			<div class="modal fade" id="photoCarousel-{{ userProfile.id }}" tabindex="-1" aria-labelledby="photoCarouselLabel" aria-hidden="true">
				<div class="modal-dialog modal-fullscreen">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
						</div>
						<div class="modal-body">
							<div id="carouselExample{{ userProfile.id }}" class="carousel slide" data-bs-ride="carousel">
								<div class="carousel-inner">
									{% for photo in userProfile.photos %}
										<div class="carousel-item {% if loop.first %}active{% endif %}">
											<img src="{{ asset('uploads/photos/' ~ photo) }}" class="d-block" alt="Photo utilisateur" style="width: 300px; height: 300px; object-fit: cover;">
										</div>
									{% endfor %}
								</div>
								<button class="carousel-control-prev" type="button" data-bs-target="#carouselExample{{ userProfile.id }}" data-bs-slide="prev">
									<span class="carousel-control-prev-icon"></span>
									<span class="visually-hidden">Précédent</span>
								</button>
								<button class="carousel-control-next" type="button" data-bs-target="#carouselExample{{ userProfile.id }}" data-bs-slide="next">
									<span class="carousel-control-next-icon"></span>
									<span class="visually-hidden">Suivant</span>
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		{% else %}
			<p>
				<em>Pour voir la galerie de photos, vous devez être abonné.
					<a href="{{ path('app_stripe_subscribe') }}">S'abonner</a>
				</em>
			</p>
		{% endif %}
<div class="profile-buttons">
	<a href="{{ path('app_messages', { id: userProfile.user.id }) }}">
		<img src="/public/images/messagerie.png" alt="Messagerie">
	</a>

	<form action="{{ path('app_profile_like', { id: userProfile.id }) }}" method="POST">
		<input type="hidden" name="_token" value="{{ csrf_token('like' ~ userProfile.id) }}">
		<button type="button" class="btn-like" title="Liker ce profil" data-id="{{ userProfile.id }}" data-token="{{ csrf_token('like' ~ userProfile.id) }}" data-url="{{ path('app_profile_like', { id: userProfile.id }) }}">
			<img src="/public/images/like.png" alt="Like">
		</button>
	</form>
</div>

 <script src="{{ asset('script/js/profile-detail.js') }}" defer></script>
 <script>
document.querySelectorAll('.btn-like').forEach(button => {
    button.addEventListener('click', () => {
        const url = button.getAttribute('data-url');
        const csrfToken = button.getAttribute('data-token');

        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest',
            },
            body: JSON.stringify({ _token: csrfToken })
        })
        .then(res => res.json())
        .then(data => alert(data.message))
        .catch(error => {
            alert('Erreur lors du like');
            console.error(error);
        });
    });
});
</script>


{% endblock %}

